;-----------------------------------------------------------------------------
; Paul Wasson - 2024
;-----------------------------------------------------------------------------
; Display DHGR monochrome image
;-----------------------------------------------------------------------------

.include "defines.asm"

;-----------------------------------------------------------------------------

.proc main
	jsr 	init
    jsr     clearScreen

    lda     #$00
    sta     screenPtr0
    lda     #$20
    sta     screenPtr1

    lda     #$00
    sta     screenPtr0
    lda     #$20
    sta     screenPtr1

    lda 	#<wizard
    sta 	bgPtr0
    lda 	#>wizard
    sta 	bgPtr1


    ldy 	#0
    lda		(bgPtr0),y
    sta     RAMWRTON  			; aux  
    sta 	(screenPtr0),y
    sta     RAMWRTOFF  			; main  
    iny

.endproc

;-----------------------------
.proc init

    ; Set up text screen
    jsr     $c300       ; 80 column mode
    jsr     HOME        ; clear screen
    lda     #23         ; put cursor on last line
    sta     CV
    jsr     VTAB

    ; init DHGR (monochrome)

    sta     MIXCLR
    sta     HIRES
    sta     TXTCLR
    sta     LOWSCR
    ldx     #2
:
    sta     SET80COL
    sta     SET80VID 
    sta     CLR80VID
    sta     DHIRESON
    sta     DHIRESOFF
    sta     SET80VID 
    sta     DHIRESON
    dex
    bne     :-
    sta     MIXCLR
    rts
.endproc

;-----------------------------

.proc clearScreen:
    lda     #$00
    sta     screenPtr0
    lda     #$20
    sta     screenPtr1
    sta     CLR80COL        ; Use RAMWRT for aux mem
loop:
    ldy     #0
    ; aux mem
    lda     #0
    sta     RAMWRTON  
:
    sta     (screenPtr0),y
    iny
    bne     :-    
    sta     RAMWRTOFF
    ; main mem
:
    sta     (screenPtr0),y
    iny
    bne     :-    

    inc     screenPtr1
    lda     #$40
    cmp     screenPtr1
    bne     loop
    rts
.endproc

;-----------------------------

.align      64
lineOffset:
    .byte   <$2000
    .byte   <$2080
    .byte   <$2100
    .byte   <$2180
    .byte   <$2200
    .byte   <$2280
    .byte   <$2300
    .byte   <$2380
    .byte   <$2028
    .byte   <$20A8
    .byte   <$2128
    .byte   <$21A8
    .byte   <$2228
    .byte   <$22A8
    .byte   <$2328
    .byte   <$23A8
    .byte   <$2050
    .byte   <$20D0
    .byte   <$2150
    .byte   <$21D0
    .byte   <$2250
    .byte   <$22D0
    .byte   <$2350
    .byte   <$23D0

linePage:
    .byte   >$2000
    .byte   >$2080
    .byte   >$2100
    .byte   >$2180
    .byte   >$2200
    .byte   >$2280
    .byte   >$2300
    .byte   >$2380
    .byte   >$2028
    .byte   >$20A8
    .byte   >$2128
    .byte   >$21A8
    .byte   >$2228
    .byte   >$22A8
    .byte   >$2328
    .byte   >$23A8
    .byte   >$2050
    .byte   >$20D0
    .byte   >$2150
    .byte   >$21D0
    .byte   >$2250
    .byte   >$22D0
    .byte   >$2350
    .byte   >$23D0

;-----------------------------

; DHGR (20 bytes x 64 bytes) -> (140 pixels x 64 pixels)

wizard:
.byte 42,85,42,85,32,34,0,17,73,72,36,42,40,85,42,85,42,85,42,85
.byte 85,42,85,2,20,9,41,36,18,37,74,36,69,42,85,42,37,85,42,21
.byte 42,82,20,41,33,36,0,73,36,18,17,85,10,82,36,73,42,41,85,106
.byte 37,21,5,16,68,0,4,18,64,36,42,73,52,41,85,42,85,42,18,21
.byte 42,85,80,74,8,36,16,0,21,73,36,42,37,2,85,42,41,85,42,41
.byte 85,2,69,4,17,1,4,41,72,18,73,18,41,85,20,85,74,74,42,85
.byte 42,9,16,34,4,0,1,66,2,36,18,36,74,42,80,18,85,84,74,42
.byte 82,42,1,0,0,17,80,20,40,73,36,73,20,64,82,42,85,42,85,74
.byte 21,85,86,42,45,0,10,64,34,34,18,21,101,22,33,85,42,85,84,50
.byte 42,85,84,42,85,66,64,42,20,73,36,34,18,41,10,85,84,74,18,85
.byte 85,42,42,85,42,5,8,72,34,10,73,72,8,68,42,36,37,41,85,74
.byte 42,5,80,74,82,34,82,21,85,36,2,2,34,17,64,40,85,42,85,82
.byte 82,20,37,41,85,0,37,34,8,73,40,41,73,42,21,65,42,42,42,85
.byte 21,5,74,42,85,40,85,85,18,18,85,4,36,36,37,42,84,74,74,42
.byte 42,37,69,42,42,36,42,4,73,36,2,80,64,8,72,16,33,85,82,84
.byte 85,2,45,74,10,73,72,40,20,9,40,5,21,17,1,4,4,42,85,42
.byte 42,33,41,40,1,18,2,65,32,32,1,42,34,69,74,0,81,40,42,85
.byte 18,72,42,41,81,72,40,20,10,21,125,82,21,18,20,34,0,34,85,42
.byte 21,2,18,40,4,2,2,64,32,42,69,90,106,37,42,8,64,8,85,74
.byte 42,40,20,21,80,80,40,18,85,125,90,106,45,15,122,5,10,32,42,85
.byte 85,0,5,5,5,10,5,40,21,69,54,5,85,88,36,75,0,1,72,18
.byte 42,37,66,34,80,36,72,2,32,32,36,40,0,19,89,63,8,68,82,84
.byte 85,2,20,1,2,64,18,84,10,21,81,18,61,44,34,117,35,16,32,85
.byte 18,77,32,72,64,42,69,16,32,32,42,69,64,82,74,46,7,0,32,85
.byte 42,9,10,2,40,16,42,10,5,69,52,41,32,52,17,113,90,4,33,21
.byte 85,42,52,0,2,42,9,32,16,25,92,74,42,43,37,10,47,32,40,106
.byte 42,21,84,16,40,33,34,69,38,85,58,93,106,86,42,53,112,11,74,10
.byte 21,21,41,0,65,84,8,40,89,10,52,43,45,85,85,96,7,47,50,53
.byte 82,18,80,8,40,74,36,18,18,85,90,126,82,58,85,23,58,120,73,74
.byte 42,85,20,65,16,21,16,84,42,21,117,82,47,85,26,41,106,97,83,82
.byte 85,84,80,0,36,65,36,73,42,35,90,37,93,42,53,106,82,14,70,84
.byte 42,21,73,36,20,10,66,16,85,74,42,29,53,85,20,80,22,61,28,85
.byte 74,42,16,9,37,16,41,34,40,33,90,82,106,42,123,82,53,81,81,42
.byte 85,82,41,84,10,37,64,74,18,4,36,100,34,73,86,33,45,97,19,74
.byte 42,21,80,4,33,9,41,41,36,41,65,94,77,54,109,10,91,75,34,84
.byte 82,84,36,41,37,18,72,82,18,85,86,123,75,109,91,33,116,14,43,33
.byte 21,21,82,2,17,37,85,20,105,54,85,45,63,91,111,10,73,59,81,44
.byte 42,21,69,68,34,9,40,85,42,109,38,119,109,118,122,17,10,108,38,81
.byte 42,5,18,5,42,82,74,42,117,58,73,116,127,127,87,71,52,81,21,21
.byte 37,25,4,82,80,4,42,85,42,119,50,21,85,42,93,13,41,38,46,104
.byte 42,85,80,16,5,81,42,53,91,84,106,42,107,127,127,95,90,84,72,21
.byte 42,85,32,41,82,66,82,42,85,45,125,43,42,41,85,10,16,85,10,37
.byte 37,42,73,16,10,90,42,45,21,81,46,87,85,118,123,95,42,85,18,105
.byte 42,37,34,69,68,32,37,85,42,109,117,125,106,42,45,29,49,42,82,42
.byte 85,42,65,10,21,20,40,106,85,26,91,107,87,55,123,54,42,33,37,84
.byte 42,21,41,74,4,41,83,86,42,127,110,126,46,109,87,126,36,74,42,41
.byte 82,72,32,5,33,80,42,45,85,86,125,91,59,61,125,69,97,20,41,75
.byte 21,83,34,41,0,34,81,90,82,61,87,126,109,106,43,85,12,21,74,84
.byte 42,42,9,4,42,36,42,53,45,107,125,107,55,53,125,69,18,41,80,42
.byte 42,85,66,20,0,65,106,84,42,61,87,62,109,90,87,42,84,80,5,85
.byte 82,42,1,5,41,4,18,85,82,106,94,117,43,109,46,73,20,33,40,40
.byte 85,36,38,10,4,16,85,42,45,43,43,47,87,90,85,36,40,69,83,66
.byte 74,42,1,41,18,9,82,90,82,90,125,90,61,43,61,8,81,10,66,20
.byte 82,42,8,18,8,0,18,37,21,117,86,106,107,42,67,81,16,37,21,9
.byte 85,10,65,36,34,21,32,85,82,46,59,87,94,109,20,18,33,9,37,42
.byte 42,1,8,10,8,0,36,42,85,106,110,90,50,43,5,34,73,42,74,84
.byte 42,84,66,16,33,18,64,16,81,90,90,53,85,42,21,65,2,5,21,33
.byte 5,16,0,22,4,1,80,42,42,85,85,46,43,91,66,16,2,74,2,72
.byte 34,109,10,41,40,22,10,4,21,54,53,85,34,37,9,64,68,16,41,17
.byte 2,8,0,68,64,0,0,41,104,40,45,53,85,18,0,4,9,10,18,72
.byte 81,8,9,41,18,18,32,16,64,42,85,45,41,9,20,65,84,80,4,2
.byte 0,34,0,72,64,0,9,32,18,37,85,82,40,0,9,8,32,2,41,72
.byte 84,0,36,18,9,10,0,10,0,73,42,21,4,10,18,1,10,72,2,32
.byte 0,34,0,40,34,0,33,64,36,34,41,4,32,32,10,68,80,2,21,5